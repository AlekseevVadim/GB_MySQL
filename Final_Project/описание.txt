База данных (БД) yutu_music

Краткое описание
Структура базы данных создана на основе анализа сервиса для прослушивания музыки "YouTube Music": https://music.youtube.com/ и описывает предполагаемую модель хранения используемых им данных.

База данных содержит 10 таблиц, хранящих данные об основных сущностях сервиса:
1. пользователи - users
2. профили пользователей - profiles
3. страны - countries
4. города - cities
5. медиафайлы - media
6. исполнители - artists
7. плейлисты - playlists
8. "лайки/подписки" пользователей - likes
9. принадлежность медиафайлов плейлистам - playlists_objects
10. история воспроизведения медиафайлов пользователями - users_plays

Для наполнения таблиц БД данными был использован сервис генерации данных: http://filldb.info/.

Содержание файлов для создания БД представлено ниже.

- Скрипты создания таблиц БД представлены в файле "yt_create_tables.sql".
- Cкрипты по наполнению БД сгенерированными данными представлены в файле "fulldb_yutu.sql".
- Скрипты редактирования сгенерированных данных, а также связанной с этим доработки структуры БД представлены в файле "yt_correcting_data.sql".
- Скрипты создания внешних ключей для таблиц БД представлены в файле "yt_create_foreign_key.sql".
- Скрипты создания тригеров, функций, процедур используемых для работы БД представлены в файле "yt_create_triggers_procedures_functions.sql"
- Скрипты создания индексов, представлений и некоторых выборок для таблиц БД представлены в файле "yt_view_queries.sql".
- Структура БД представлена в виде ERD диаграммы в файлах "ERD.pdf" и "ERD.jpeg"
- Дамп созданной БД представлен в файле "yutu_music_full.sql"


В БД реализованы следующие тригеры:
- Триггер для проверки ссылочной целостности столбца target_id
таблицы likes перед вставкой
- Триггер для проверки существования записи в таблице likes перед вставкой
- Триггеры для корректировки значения restricted_mode таблицы profiles в соответствии с возрастом пользователя перед вставкой новых строк и обновлении
- Триггеры для форматирования сетевых адресов net_adress таблиц profiles, artists, playlists перед вставкой
- Триггер для корректировки порядкового номера медиафайла перед вставкой в конец плейлиста для таблицы playlists_objects
- Триггер для корректировки порядкового номера медиафайла перед обновлением (и переносом в конец плейлиста) для таблицы playlists_objects

В БД реализованы следующие функции:
- функция проверки существования строки с соответствующим идентификатором в таблице, принимающая идентификатор и некоторую ссылку на таблицу для проверки, и возвращающая boolean
- функция для генерации псевдоуникального 36-значного номера для задания сетевого адреса на котором могут быть представлены хранимые данные

В БД реализованы следующие процедуры:
- процедура для вставки медиафайла в плейлист с корректровкой порядковых номеров других медиафайлов в плейлисте для таблицы playlists_objects
- процедура для обновления медиафайла в плейлисте с корректровкой порядковых номеров других медиафайлов в плейлисте для таблицы playlists_objects
- процедура для удаления медиафайла из плейлиста с корректровкой порядковых номеров других медиафайлов в плейлисте для таблицы playlists_objects

В БД реализованы следующие представления:
- users_info - содержит всю информацию о пользователях сервиса, объединенную из данных таблиц users, profiles, cities, countries
- artists_stats - содержит некоторую статистику об исполнителях, а именно:
количество загруженных медиафайлов, отдельно количества аудио- и видеофайлов, количество альбомов а также количество поставленных пользователями лайков (подписок)

В качестве примеров выборок, которые можно запросить из БД приведены следующие:
- Выборка с подсчетом количеств прослушиваний для разных жанров с 7 до 10 утра.
- Подсчет числа пользователей по возрастным группам
- Выборка прослушенных конкретным пользователем медиа, с учетом времени прослушивания каждой композиции
- Выборка медиафайлов, подобранная на основании наиболее прослушиваемого пользователем жанра
- Выборка стран c подсчетом числа созданных плейлистов пользователями до 20 лет